<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Izin Siswa - Piket Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-link { @apply bg-blue-700 text-white; }
        #video { width: 100%; max-width: 300px; border-radius: 8px; }
        #canvas { display: none; }
    </style>
</head>
<body class="bg-gray-100 font-sans">

<div class="flex h-screen">
    <div class="w-64 bg-blue-900 text-white flex flex-col">
        <div class="p-6 text-2xl font-bold border-b border-blue-800">E-PIKET</div>
        <nav class="flex-1 p-4 space-y-2">
            <button onclick="showPage('dashboard')" class="w-full text-left p-3 rounded hover:bg-blue-800 transition">Dashboard</button>
            <button onclick="showPage('form-izin')" class="w-full text-left p-3 rounded hover:bg-blue-800 transition">Izin Baru</button>
            <button onclick="showPage('laporan')" class="w-full text-left p-3 rounded hover:bg-blue-800 transition">Laporan Izin</button>
        </nav>
    </div>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white shadow-sm p-4 text-xl font-semibold text-gray-700">Sistem Administrasi Izin Siswa</header>
        
        <main class="flex-1 overflow-y-auto p-6">
            
            <div id="page-dashboard" class="page-content">
                <h2 class="text-2xl font-bold mb-4">Selamat Datang, Petugas Piket</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
                        <p class="text-gray-500">Total Izin Hari Ini</p>
                        <p id="stat-count" class="text-3xl font-bold text-gray-800">0</p>
                    </div>
                </div>
            </div>

            <div id="page-form-izin" class="page-content hidden">
                <div class="max-w-2xl bg-white p-8 rounded-lg shadow">
                    <h2 class="text-xl font-bold mb-6 border-b pb-2">Form Izin Baru</h2>
                    <form id="izinForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="nis" placeholder="NIS" class="border p-2 rounded w-full" required>
                            <input type="text" id="nama" placeholder="Nama Siswa" class="border p-2 rounded w-full" required>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="text" id="kelas" placeholder="Kelas" class="border p-2 rounded w-full" required>
                            <select id="jenis_izin" class="border p-2 rounded w-full">
                                <option value="Keluar">Izin Keluar</option>
                                <option value="Masuk">Izin Masuk (Terlambat)</option>
                                <option value="Pulang">Izin Pulang Awal</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <input type="date" id="tanggal" class="border p-2 rounded w-full" required>
                            <input type="text" id="petugas" placeholder="Nama Petugas Piket" class="border p-2 rounded w-full" required>
                        </div>
                        <textarea id="alasan" placeholder="Alasan/Keterangan" class="border p-2 rounded w-full h-24"></textarea>
                        
                        <div class="bg-gray-50 p-4 rounded border text-center">
                            <p class="text-sm mb-2 text-gray-600">Dokumentasi Foto</p>
                            <video id="video" autoplay></video>
                            <canvas id="canvas"></canvas>
                            <div class="mt-2">
                                <button type="button" onclick="takeSnapshot()" class="bg-green-600 text-white px-4 py-1 rounded text-sm">Ambil Foto</button>
                            </div>
                            <img id="photo-preview" class="mt-2 mx-auto hidden border-2 border-blue-500 rounded" width="150">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white p-3 rounded font-bold hover:bg-blue-700">SIMPAN DATA IZIN</button>
                    </form>
                </div>
            </div>

            <div id="page-laporan" class="page-content hidden">
                <h2 class="text-xl font-bold mb-4">Laporan Izin Siswa</h2>
                <div class="bg-white rounded-lg shadow overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="p-3 border">Tgl</th>
                                <th class="p-3 border">Siswa (NIS)</th>
                                <th class="p-3 border">Kelas</th>
                                <th class="p-3 border">Jenis</th>
                                <th class="p-3 border">Alasan</th>
                                <th class="p-3 border">Foto</th>
                            </tr>
                        </thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>
</div>

<script>
    // Inisialisasi Kamera
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photoPreview = document.getElementById('photo-preview');
    let capturedImage = "";

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => console.error("Kamera tidak aktif: ", err));

    function takeSnapshot() {
        const context = canvas.getContext('2d');
        canvas.width = 300;
        canvas.height = 225;
        context.drawImage(video, 0, 0, 300, 225);
        capturedImage = canvas.toDataURL('image/png');
        photoPreview.src = capturedImage;
        photoPreview.classList.remove('hidden');
    }

    // Fungsi Navigasi
    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + pageId).classList.remove('hidden');
        if(pageId === 'laporan') renderTable();
        if(pageId === 'dashboard') updateStats();
    }

    // Fungsi Simpan Data
    document.getElementById('izinForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = {
            nis: document.getElementById('nis').value,
            nama: document.getElementById('nama').value,
            kelas: document.getElementById('kelas').value,
            jenis: document.getElementById('jenis_izin').value,
            tanggal: document.getElementById('tanggal.value'),
            petugas: document.getElementById('petugas').value,
            alasan: document.getElementById('alasan').value,
            foto: capturedImage
        };

        let storage = JSON.parse(localStorage.getItem('izinSiswa')) || [];
        storage.push(data);
        localStorage.setItem('izinSiswa', JSON.stringify(storage));
        
        alert('Data berhasil disimpan!');
        this.reset();
        photoPreview.classList.add('hidden');
        showPage('dashboard');
    });

    function renderTable() {
        const storage = JSON.parse(localStorage.getItem('izinSiswa')) || [];
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = storage.map(item => `
            <tr class="hover:bg-gray-50">
                <td class="p-3 border">${item.tanggal}</td>
                <td class="p-3 border">${item.nama} (${item.nis})</td>
                <td class="p-3 border">${item.kelas}</td>
                <td class="p-3 border">${item.jenis}</td>
                <td class="p-3 border">${item.alasan}</td>
                <td class="p-3 border"><img src="${item.foto}" width="50"></td>
            </tr>
        `).join('');
    }

    function updateStats() {
        const storage = JSON.parse(localStorage.getItem('izinSiswa')) || [];
        document.getElementById('stat-count').innerText = storage.length;
    }

    updateStats();
</script>
</body>
</html>
