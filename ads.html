<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Aplikasi Telegram Mini - Otorisasi</title> <script src="https://telegram.org/js/telegram-web-app.js"></script> <style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; margin: 0; overflow-x: tersembunyi; } .auth-container { latar belakang: putih; radius-batas: 20px; bayangan-kotak: 0 20px 40px rgba(0,0,0,0.1); lebar: 100%; lebar-maks: 400px; overflow: tersembunyi; posisi: relatif; } .auth-header { latar belakang: gradien-linier(135derajat, #0088cc, #0066aa); warna: putih; bantalan: 30px 20px; perataan-teks: tengah; posisi: relatif; } .telegram-icon { lebar: 60px; tinggi: 60px; latar belakang: rgba(255,255,255,0.2); radius-batas: 50%; tampilan: fleksibel; perataan-item: tengah; pembenaran-konten: tengah; margin: 0 otomatis 15px; ukuran-font: 30px; } .auth-header h1 { ukuran-font: 24px; berat-font: 600; margin-bottom: 5px; } .auth-header p { opasitas: 0,9; ukuran-font: 14px; } .auth-tabs { tampilan: fleksibel; latar belakang: #f8f9fa; batas-bawah: 1px solid #e9ecef; } .tab-button { fleksibel: 1; bantalan: 15px; latar belakang: tidak ada; batas: tidak ada; ukuran-font: 16px; berat-font: 500; kursor: penunjuk; transisi: semua 0,3s mudah; warna: #6c757d; } .tab-button.aktif { latar belakang: putih; warna: #0088cc; batas-bawah: 2px solid #0088cc; } .auth-form { bantalan: 30px; } .form-group { margin-bottom: 20px; } .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px; } .form-input { width: 100%; padding: 12px 16px; border: 2px solid #e9ecef; border-radius: 10px; font-size:16px; transisi: semua 0,3 detik ease; latar belakang: #f8f9fa; } .form-input:fokus { garis luar: tidak ada; warna batas: #0088cc; latar belakang: putih; bayangan kotak: 0 0 0 3px rgba(0,136,204,0.1); } .auth-button { lebar: 100%; bantalan: 14px; latar belakang: gradien-linier(135derajat, #0088cc, #0066aa); warna: putih; batas: tidak ada; radius-batas: 10px; ukuran-font: 16px; bobot-font: 600; kursor: penunjuk; transisi: semua 0,3 detik ease; margin-atas: 10px; } .auth-button:hover { transformasi: translateY(-2px); bayangan-kotak: 0 10px 20px rgba(0,136,204,0.3); } .tombol-auth:aktif { transformasi: terjemahkanY(0); } .lupa-sandi { perataan-teks: tengah; margin-atas: 20px; } .lupa-sandi a { warna: #0088cc; dekorasi-teks: tidak ada; ukuran-font: 14px; } .lupa-sandi a:hover { dekorasi-teks: garis bawah; } .bagian-formulir { tampilan: tidak ada; } .bagian-formulir.aktif { tampilan: blok; } .pesan-berhasil { latar belakang: #d4edda; warna: #155724; bantalan: 12px; radius-batas: 8px; margin-bawah: 20px; batas: 1px padat #c3e6cb; tampilan: tidak ada; } .error-message { latar belakang: #f8d7da; warna: #721c24; bantalan: 12px; radius batas: 8px; margin-bawah: 20px; batas: 1px solid #f5c6cb; tampilan: tidak ada; } @media (lebar-maks: 480px) { .auth-container { margin: 10px; } .auth-form { bantalan: 20px; } } </style> </head> <body> <div class="auth-container"> <div class="auth-header"> <div class="telegram-icon">✈️</div> <h1>Aplikasi Mini Telegram</h1> <p>Selamat datang di aplikasi kami</p> </div> <div class="auth-tabs"> <button class="tab-button active" onclick="switchTab('login')">Masuk</button> <button class="tab-button" onclick="switchTab('register')">Daftar</button> </div> <!-- Formulir Masuk --> <div id="login-section" class="form-section active"> <form class="auth-form" onsubmit="handleLogin(event)"> <div class="success-message" id="login-success"></div> <div class="error-message" id="login-error"></div> <div class="form-group"> <label for="login-email">Email atau Nama Pengguna</label> <input type="text" id="login-email" class="form-input" placeholder="Masukkan email atau nama pengguna" diperlukan> </div> <div class="form-group"> <label for="login-password">Kata Sandi</label> <input type="password" id="login-password" class="form-input" placeholder="Masukkan kata sandi" diperlukan> </div> <button type="submit" class="auth-button">Masuk</button> <div class="forgot-password"> <a href="#" onclick="showForgotPassword()">Lupa kata sandi?</a> </div> </form> </div> <!-- Formulir Pendaftaran --> <div id="register-section" class="form-section"> <form class="auth-form" onsubmit="handleRegister(event)"> <div class="success-message" id="register-success"></div> <div class="error-message" id="register-error"></div> <div class="form-group"> <label for="register-name">Nama Lengkap</label> <input type="text" id="register-name" class="form-input" placeholder="Masukkan nama lengkap" required> </div> <div class="form-group"> <label for="register-username">Nama Pengguna</label> <input type="text" id="register-username" class="form-input" placeholder="Pilih nama pengguna unik" required> </div> <div class="form-group"> <label for="register-email">Email</label> <input type="email" id="register-email" class="form-input" placeholder="Masukkan email aktif" required> </div> <div class="form-group"> <label for="register-password">Kata Sandi</label> <input type="password" id="register-password" class="form-input" placeholder="Minimal 6 karakter" required minlength="6"> </div> <div class="form-group"> <label for="register-confirm">Konfirmasi Kata Sandi</label> <input type="password" id="register-confirm" class="form-input" placeholder="Ulangi kata sandi" required> </div> <button type="submit" class="auth-button">Daftar Sekarang</button> </form> </div> </div> <!-- Dashboard Page --> <div id="dashboard" class="auth-container" style="display:none;"> <div class="auth-header"> <div class="telegram-icon">🎯</div> <h1 id="welcome-user">Dashboard</h1> <p>Keluarkan iklan dan dapatkan reward</p> </div> <div class="auth-form"> <div class="success-message" id="dashboard-success"></div> <div class="error-message" id="dashboard-error"></div> <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 30px;"> <h3 style="color: #333; margin-bottom: 10px;">Status Akun</h3> <p style="color: #666; margin-bottom: 5px;">👤 <span id="user-name"></span></p> <p style="color: #666; margin-bottom: 5px;">📧 <span id="user-email"></span></p> <p style="color: #28a745; font-weight: 600;">💰 Hadiah: <span id="user-points">0</span> Poin</p> </div> <div style="display: grid; gap: 20px; margin-bottom: 30px;"> <div> <button class="auth-button" onclick="viewAds()" style="background: linear-gradient(135deg, #28a745, #20c997);"> 📺 Lihat Iklan (+1000 Poin) </button> <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #666;"> Hari ini: <span id="view-ads-count">0</span>/100 iklan </div> </div> <div> <button class="auth-button" onclick="showPopupAds()" style="background: linear-gradient(135deg, #fd7e14, #e83e8c);"> 🎪 Popup Ads (+50 Poin) </button> <div style="text-align: center; margin-top: 8px; font-size: 14px; color: #666;"> Hari ini: <span id="popup-ads-count">0</span>/100 iklan </div> </div> <button class="auth-button" onclick="showExchangeMenu()" style="background: linear-gradient(135deg, #17a2b8, #138496);"> 💳 Tukar Poin </button> <button class="auth-button" onclick="showSpreadsheetData()" style="background: linear-gradient(135deg, #6f42c1,#5a32a3);"> 📊 Transaksi Data </button> </div> <button class="auth-button" onclick="logout()" style="background: linear-gradient(135deg, #6c757d, #495057);"> 🚪 Keluar </button> </div> </div> <!-- Modal Iklan Popup --> <div id="popup-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;"> <div style="background: white; border-radius: 15px; padding: 30px; max-width: 350px; width: 90%; text-align: center; position: relative;"> <button onclick="closePopupAds()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">×</button> <div style="font-size: 60px; margin-bottom: 20px;">🎁</div> <h2 style="color: #333; margin-bottom: 15px;">Selamat!</h2> <p style="color: #666; margin-bottom: 25px;">Anda mendapat hadiah dari menonton iklan popup!</p> <div style="background: #28a745; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;"> <strong>+50 Poin Reward!</strong> </div> <button onclick="closePopupAds()" class="auth-button" style="background: linear-gradient(135deg, #28a745, #20c997);"> Terima Hadiah </button> </div> </div> <!-- Exchange Points Modal --> <div id="exchange-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;"> <div style="background: white; border-radius: 15px; padding: 30px; max-width: 400px; width: 90%; text-align: center; position: relative; max-height: 80vh; overflow-y: auto;"> <button onclick="closeExchangeMenu()" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">×</button> <div style="font-size: 50px; margin-bottom: 20px;">💳</div> <h2 style="color: #333; margin-bottom: 15px;">Tukar Poin ke Saldo DANA</h2> <p style="color: #666; margin-bottom: 25px;">Pilih nominal yang ingin ditukar:</p> <div style="display: grid; gap: 15px; margin-bottom:20px;"> <div onclick="exchangePoints(1000, 1100)" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#e9ecef'"> <div style="font-weight: 600; color: #333; margin-bottom: 5px;">💰 Saldo DANA Rp 1.000</div> <div style="color: #666; font-size: 14px;">Biaya: 1.100 Poin</div> </div> <div onclick="exchangePoints(2000, 2100)" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#e9ecef'"> <div style="font-weight: 600; color: #333; margin-bottom: 5px;">💰 Saldo DANA Rp 2.000</div> <div style="color: #666; font-size: 14px;">Biaya: 2.100 Poin</div> </div> <div onclick="exchangePoints(3000, 3100)" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#e9ecef'"> <div style="font-weight: 600; color: #333; margin-bottom: 5px;">💰 Saldo DANA Rp 3.000</div> <div style="color: #666; font-size: 14px;">Biaya: 3.100 Poin</div> </div> <div onclick="exchangePoints(4000, 4100)" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#e9ecef'"> <div style="font-weight: 600; color: #333; margin-bottom: 5px;">💰 Saldo DANA Rp 4.000</div> <div style="color: #666; font-size: 14px;">Biaya: 4.100 Poin</div> </div> <div onclick="exchangePoints(5000, 5100)" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#e9ecef'"> <div style="font-weight: 600; color:#333; margin-bottom: 5px;">💰 Saldo DANA Rp 5.000</div> <div style="color: #666; font-size: 14px;">Biaya: 5.100 Poin</div> </div> </div> <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 12px; border-radius: 8px; font-size: 14px;"> ⚠️ Poin Anda saat ini: <span id="current-points-display">0</span> </div> </div> </div> <!-- Spreadsheet Data Modal --> <div id="spreadsheet-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; tinggi: 100%; latar belakang: rgba(0,0,0,0.8); indeks-z: 1000; sejajarkan-item: tengah; ratakan-konten: tengah;"> <div style="latar belakang: putih; radius-batas: 15px; bantalan: 30px; lebar-maks: 90%; lebar: 800px; tinggi-maks: 80vh; luapan-y: otomatis; posisi: relatif;"> <tombol onclick="tutupDataSpreadsheet()" style="posisi: absolut; atas: 10px; kanan: 15px; latar belakang: tidak ada; batas: tidak ada; ukuran-font: 24px; kursor: penunjuk; warna: #999;">×</tombol> <div style="ukuran-font: 50px; margin-bawah: 20px; perataan-teks: tengah;">📊</div> <h2 style="warna: #333; margin-bottom: 15px; text-align: center;">Data Transaksi Spreadsheet</h2> <p style="color: #666; margin-bottom: 25px; text-align: center;">Riwayat semua transaksi pertukaran poin</p> <div id="spreadsheet-loading" style="text-align: center; padding: 40px; display: none;"> <div style="font-size: 40px; margin-bottom: 15px;">⏳</div> <p style="color: #666;">Memuat data transaksi...</p> </div> <div id="spreadsheet-content"> <div style="overflow-x: auto;"> <table id="transactions-table" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;"> <thead> <tr style="background: #f8f9fa;"> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">ID</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">Tangga</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">Email</th> <th style="border: 1px solid #dee2e6; padding:12px; text-align: left; font-weight: 600; color: #333;">Nama</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">Tidak Ada HP</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">Hadiah</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; color: #333;">Poin</th> <th style="border: 1px solid #dee2e6; padding: 12px; text-align: left; font-weight: 600; warna: #333;">Status</th> </tr> </thead> <tbody id="transactions-tbody"> <!-- Data akan diisi di sini --> </tbody> </table> </div> <div style="text-align: center; margin-top: 20px;"> <button onclick="refreshSpreadsheetData()" class="auth-button" style="background: linear-gradient(135deg, #28a745, #20c997); lebar: otomatis; padding: 12px 24px; margin-right: 10px;"> 🔄 Segarkan Data </button> <button onclick="exportToCSV()" class="auth-button" style="background: linear-gradient(135deg, #fd7e14, #e83e8c); lebar: otomatis; Bahasa Indonesia: padding: 12px 24px;"> 📥 Ekspor CSV </button> </div> </div> </div> </div> <!-- Modal Konfirmasi Akun Dana --> <div id="dana-confirmation-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1001; align-items: center; justify-content: center;"> <div style="background: white; border-radius: 15px; padding: 30px; max-width: 400px; width: 90%; text-align: center; position: relative;"> <button onclick="closeDanaConfirmation()" style="position: absolute; top: 10px; right: 15px; background: none; perbatasan: tidak ada; ukuran font: 24px; kursor: penunjuk; warna: #999;">×</button> <div style="ukuran font: 50 piksel; margin-bawah: 20px;">🏦</div> <h2 style="color: #333; margin-bottom: 15px;">Konfirmasi Akun DANA</h2> <p style="color: #666; margin-bottom: 25px;">Masukkan data akun DANA Anda untuk menerima saldo:</p> <div style="background: #e3f2fd; bantalan: 15 piksel; radius perbatasan:10px; margin-bottom: 25px;"> <div style="color: #1976d2; font-weight: 600; margin-bottom: 5px;">💰 Saldo DANA: Rp <span id="dana-amount-display">0</span></div> <div style="color: #666; font-size: 14px;">Biaya: <span id="dana-points-cost">0</span> Poin</div> </div> <form id="dana-account-form" onsubmit="processDanaExchange(event)"> <div style="margin-bottom: 20px; text-align: left;"> <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px;">Nama Akun DANA</label> <input type="text" id="dana-name" style="width: 100%; padding: 12px 16px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; background: #f8f9fa;" placeholder="Masukkan nama sesuai akun DANA" required> </div> <div style="margin-bottom: 25px; text-align: left;"> <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #333; font-size: 14px;">Nomor HP DANA</label> <input type="tel" id="dana-phone" style="width: 100%; padding: 12px 16px; border: 2px solid #e9ecef; border-radius: 10px; ukuran font: 16px; latar belakang: #f8f9fa;" placeholder="08xxxxxxxxxx" pattern="[0-9]{10,13}" diperlukan> </div> <div style="background: #fff3cd; batas: 1 piksel padat #ffeaa7; warna: #856404; bantalan: 12 piksel; radius batas: 8px; ukuran font: 13px; margin-bawah: 20 piksel; text-align: left;"> ⚠️ <strong>Penting:</strong><br> • Pastikan nama dan nomor HP sesuai dengan akun DANA Anda<br> • Saldo akan dikirim dalam 1x24 jam<br> • Transaksi tidak dapat dibatalkan </div> <button type="submit" style="width: 100%; bantalan: 14 piksel; background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;"> 📤 Kirim </button> </form> </div> </div> <script> // Inisialisasi Telegram Web App if (window.Telegram dan window.Telegram.WebApp) { const tg = window.Telegram.WebApp; tg.ready(); tg.expand(); } // Penyimpanan untuk pengguna terdaftar let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || []; let currentUser = null; function switchTab(tab) { // Perbarui tombol tab document.querySelectorAll('.tab-button').forEach(btn => { btn.classList.remove('active'); }); // Temukan tombol yang diklik dan aktifkan const clickedButton = Array.from(document.querySelectorAll('.tab-button')).find(btn => btn.textContent.includes(tab === 'login' ? 'Masuk' : 'Daftar') ); if (clickedButton) { clickedButton.classList.add('active'); } // Perbarui bagian formulir document.querySelectorAll('.form-section').forEach(section => { section.classList.remove('active'); }); document.getElementById(tab + '-section').classList.add('active'); // Hapus pesan clearMessages(); } function clearMessages() { document.querySelectorAll('.success-message, .error-message').forEach(msg => { msg.style.display = 'none'; }); } function showMessage(type, message, section) { clearMessages(); const messageEl = document.getElementById(section + '-' + type); messageEl.textContent = pesan; messageEl.style.display = 'block'; } function handleLogin(event) { event.preventDefault(); const email = document.getElementById('login-email').value; const password = document.getElementById('login-password').value; // Periksa pengguna terdaftar const user = registeredUsers.find(u => u.email === email && u.password === password); if (user) { currentUser = user; showMessage('success', `Login berhasil! Selamat datang, ${user.name}!`, 'login'); // Redirect ke dashboard setelah berhasil setTimeout(() => { showDashboard(); }, 1500); } else { showMessage('error', 'Email atau password salah. Pastikan Anda sudah terdaftar!', 'login'); } } function handleRegister(event) { event.preventDefault(); const name = document.getElementById('register-name').value; const username = document.getElementById('register-username').value; const email = document.getElementById('register-email').value; const password = document.getElementById('kata sandi-register').nilai; const confirmPassword = dokumen.getElementById('register-confirm').value;

            // Validation
            if (password !== confirmPassword) {
                showMessage('error', 'Password dan konfirmasi password tidak cocok!', 'register');
                return;
            }

            if (username.length < 3) {
                showMessage('error', 'Username minimal 3 karakter!', 'register');
                return;
            }

            // Check if email already exists
            if (registeredUsers.find(u => u.email === email)) {
                showMessage('error', 'Email sudah terdaftar! Gunakan email lain atau login.', 'register');
                return;
            }

            // Save new user
            const newUser = { name, username, email, password };
            registeredUsers.push(newUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));

            showMessage('success', `Pendaftaran berhasil! Selamat datang, ${name}!`, 'register');
            
            // Auto switch to login after successful registration
            setTimeout(() => {
                switchTab('login');
                showMessage('success', 'Akun berhasil dibuat. Silakan login dengan akun baru Anda.', 'login');
                // Clear form
                document.getElementById('register-section').querySelector('form').reset();
            }, 2000);
        }

        function showForgotPassword() {
            alert('Fitur reset password akan segera tersedia!\n\nSilakan daftar akun baru untuk mencoba aplikasi.');
        }

        function showDashboard() {
            // Hide auth container and show dashboard
            document.querySelector('.auth-container').style.display = 'none';
            const dashboard = document.getElementById('dashboard');
            dashboard.style.display = 'block';
            
            // Ensure body maintains background
            document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            document.body.style.minHeight = '100vh';
            
            // Update user info
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-email').textContent = currentUser.email;
            document.getElementById('welcome-user').textContent = `Halo, ${currentUser.name}!`;
            
            // Load user points
            const userPoints = localStorage.getItem(`points_${currentUser.email}`) || 0;
            document.getElementById('user-points').textContent = userPoints;
            
            // Load daily ad counts
            const today = new Date().toDateString();
            const viewAdsCount = localStorage.getItem(`viewAds_${currentUser.email}_${today}`) || 0;
            const popupAdsCount = localStorage.getItem(`popupAds_${currentUser.email}_${today}`) || 0;
            
            document.getElementById('view-ads-count').textContent = viewAdsCount;
            document.getElementById('popup-ads-count').textContent = popupAdsCount;
        }

        function viewAds() {
            const today = new Date().toDateString();
            const viewAdsKey = `viewAds_${currentUser.email}_${today}`;
            const currentViewAds = parseInt(localStorage.getItem(viewAdsKey) || 0);
            
            if (currentViewAds >= 100) {
                showMessage('error', 'Batas harian tercapai! Anda sudah menonton 100 iklan video hari ini. Coba lagi besok!', 'dashboard');
                return;
            }
            
            showMessage('success', 'Menonton iklan video... Tunggu 30 detik untuk mendapat reward!', 'dashboard');
            
            // Simulate watching ads
            setTimeout(() => {
                const newCount = currentViewAds + 1;
                localStorage.setItem(viewAdsKey, newCount);
                document.getElementById('view-ads-count').textContent = newCount;
                
                addPoints(1000);
                showMessage('success', `Selamat! Anda mendapat +1000 poin dari menonton iklan video! (${newCount}/100)`, 'dashboard');
            }, 3000);
        }

        function showPopupAds() {
            const today = new Date().toDateString();
            const popupAdsKey = `popupAds_${currentUser.email}_${today}`;
            const currentPopupAds = parseInt(localStorage.getItem(popupAdsKey) || 0);
            
            if (currentPopupAds >= 100) {
                showMessage('error', 'Batas harian tercapai! Anda sudah menonton 100 iklan popup hari ini. Coba lagi besok!', 'dashboard');
                return;
            }
            
            document.getElementById('popup-modal').style.display = 'flex';
        }

        function closePopupAds() {
            const today = new Date().toDateString();
            const popupAdsKey = `popupAds_${currentUser.email}_${today}`;
            const currentPopupAds = parseInt(localStorage.getItem(popupAdsKey) || 0);
            const newCount = currentPopupAds + 1;
            
            localStorage.setItem(popupAdsKey, newCount);
            document.getElementById('popup-ads-count').textContent = newCount;
            
            document.getElementById('popup-modal').style.display = 'none';
            addPoints(50);
            showMessage('success', `Reward +50 poin berhasil ditambahkan ke akun Anda! (${newCount}/100)`, 'dashboard');
        }

        function addPoints(points) {
            const currentPoints = parseInt(localStorage.getItem(`points_${currentUser.email}`) || 0); const newPoints = currentPoints + points; localStorage.setItem(`points_${currentUser.email}`, newPoints); document.getElementById('user-points').textContent = newPoints; } function showExchangeMenu() { const currentPoints = parseInt(localStorage.getItem(`points_${currentUser.email}`) || 0); document.getElementById('current-points-display').textContent = currentPoints; document.getElementById('exchange-modal').style.display = 'flex'; } function closeExchangeMenu() { document.getElementById('exchange-modal').style.display = 'none'; } fungsi exchangePoints(danaAmount, pointCost) { const currentPoints = parseInt(localStorage.getItem(`points_${currentUser.email}`) || 0); if (currentPoints < pointCost) { alert(`Poin tidak cukup! Anda memerlukan ${pointCost} poin, tetapi hanya memiliki ${currentPoints} poin.`); kembali; } // Tampilkan formulir konfirmasi akun Dana showDanaConfirmation(danaAmount, pointCost); } fungsi showDanaConfirmation(danaAmount, pointCost) { closeExchangeMenu(); document.getElementById('dana-amount-display').textContent = danaAmount.toLocaleString(); document.getElementById('dana-points-cost').textContent = pointCost; document.getElementById('dana-konfirmasi-modal').style.display = 'flex'; } function closeDanaConfirmation() { document.getElementById('dana-confirmation-modal').style.display = 'none'; document.getElementById('dana-account-form').reset(); } function processDanaExchange(event) { event.preventDefault(); const danaName = document.getElementById('dana-name').value.trim(); const danaPhone = document.getElementById('dana-phone').value.trim(); const danaAmount = parseInt(document.getElementById('dana-amount-display').textContent.replace(/\./g, '')); const pointCost = parseInt(document.getElementById('dana-points-cost').textContent); const currentPoints = parseInt(localStorage.getItem(`points_${currentUser.email}`) || 0); // Validasi kolom yang wajib diisi if (!danaName || danaName.length < 2) { alert('Nama akun DANA harus diisi minimal 2 karakter!'); kembali salah; } if (!danaPhone || danaPhone.length < 10 || danaPhone.length > 13) { alert('Nomor HP tidak valid! Masukkan nomor HP yang benar (10-13 digit).'); return false; } // Periksa apakah poin cukup if (currentPoints < pointCost) { alert(`Poin tidak cukup! Anda membutuhkan ${pointCost} poin, tetapi hanya memiliki ${currentPoints} poin.`); return false; } // Pemrosesan segera tanpa konfirmasi const submitBtn = document.querySelector('#dana-account-form button[type="submit"]'); submitBtn.textContent = '⏳ Memproses...'; submitBtn.disabled = true; // Kurangi poin segera const newPoints = currentPoints - pointCost; localStorage.setItem(`points_${currentUser.email}`, newPoints); document.getElementById('user-points').textContent = newPoints; // Simpan transaksi ke localStorage const transactionId = Date.now(); const transaction = { id: transactionId, tanggal: new Date().toLocaleString('id-ID'), email: currentUser.email, nama: danaName, noAkun: danaPhone, hadiah: `Rp ${danaAmount.toLocaleString()}`, pointsUsed: pointCost, sisaPoin: newPoints, status: 'Pending' }; // Simpan riwayat transaksi let transactions = JSON.parse(localStorage.getItem('transactions') || '[]'); transactions.push(transaction); localStorage.setItem('transactions', JSON.stringify(transactions)); // Kirim data ke Google Sheets terlebih dahulu sendToGoogleSheets(transaction).then(() => { console.log('Data berhasil dikirim ke Google Sheets'); }).catch(error => { console.error('Kesalahan saat mengirim ke Google Sheets:', error); }); // Tampilkan kesuksesan segera setTimeout(() => { submitBtn.textContent = '✅ Berhasil Terkirim!'; submitBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)'; setTimeout(() => { // Tombol reset dan tutup modal submitBtn.textContent = '📤 Kirim'; submitBtn.style.background = 'linear-gradient(135deg, #17a2b8, #138496)'; submitBtn.disabled = false; closeDanaConfirmation(); // Tampilkan pesan sukses showMessage('success', `🎉 PENUKARAN BERHASIL! Poin ${pointCost} telah terpotong. Saldo DANA Rp ${danaAmount.toLocaleString()} akan dikirim ke ${danaName} (${danaPhone}) dalam 1x24 jam ID Transaksi: ${transactionId}.Terima kasih!`, 'dasbor'); showMessage('success', `✅ Penukaran Berhasil! Saldo DANA Rp ${danaAmount.toLocaleString()} akan dikirim ke ${danaName} (${danaPhone}) dalam 1x24 jam. ID: ${transactionId}`, 'dashboard'); }, 1000); }, 800); kembali salah; } // Berfungsi untuk mengambil data dari fungsi asinkron Google Sheets ambilFromGoogleSheets() { const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwl_TVd0d-f3CQQGzdUsmSv34Nz_Lb23hPF5qrJHSXuAWl3315siLi-1a46XDQx9T0/exec'; coba { console.log('📥 Mengambil data dari Google Sheets...'); // Tambahkan stempel waktu untuk mencegah penembolokan dan memastikan data baru const timestamp = new Date().getTime(); const fetchUrl = `${GOOGLE_SCRIPT_URL}?action=fetch&t=${timestamp}`; const response = await fetch(fetchUrl, { method: 'GET', headers: { 'Accept': 'application/json', 'Cache-Control': 'no-cache, no-store, must-revalidate', 'Pragma': 'no-cache', 'Expires': '0' }, cache: 'no-cache' }); console.log('📡 Response status:', response.status); if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); } const data = await response.json(); console.log('✅ Data berhasil diambil dari Google Sheets:', data); console.log('📊Jumlah data yang diterima:', data.length); // Ubah data agar sesuai dengan format kita const transaksi = data.map(row => ({ id: row.transactionId || row.id || row.ID, tanggal: row.tanggal || row.Tanggal, email: row.email || row.Email, nama: row.nama || row.Nama, noAkun: row.noAkun || row['No HP'] || row.noHP, hadiah: row.hadiah || row.Hadiah, poinDigunakan: baris.poinDigunakan ||. baris['Poin yang Digunakan'] ||. baris.poin, sisaPoin: baris.sisaPoin ||. baris['Sisa Poin'], status: baris.status ||. console.log('🔄 Data setelah transformasi:', transaksi); transaksi pengembalian; } catch (error) { console.error('❌ Error mengambil data dari Google Sheets:',error); console.error('❌ Detail kesalahan:', error.message); throw error; } } // Fungsi untuk mengirim data ke Google Sheets dengan debugging yang lebih baik fungsi async sendToGoogleSheets(transactionData) { // URL Google Apps Script dengan SCRIPT_ID yang benar const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwl_TVd0d-f3CQQGzdUsmSv34Nz_Lb23hPF5qrJHSXuAWl3315siLi-1a46XDQx9T0/exec'; coba { // Siapkan data untuk permintaan GET (metode paling andal) const dataToSend = { tanggal: transactionData.tanggal, transactionId: transactionData.id, email: transactionData.email, userName: currentUser.name, nama: transactionData.nama, noAkun: transactionData.noAkun, hadiah: transactionData.hadiah, pointsUsed: transactionData.pointsUsed, sisaPoin: transactionData.sisaPoin, status: transactionData.status }; console.log('📤 Mengirim data ke Google Sheets:', dataToSend); // Gunakan metode GET dengan parameter URL (paling andal untuk Google Apps Script) const params = new URLSearchParams(); Object.keys(dataToSend).forEach(key => { params.append(key, String(dataToSend[key])); }); const requestUrl = `${GOOGLE_SCRIPT_URL}?${params.toString()}`; console.log('🔗 Request URL:', requestUrl); // Kirim permintaan const response = await fetch(requestUrl, { method: 'GET', mode: 'no-cors' }); console.log('✅ Data berhasil dikirim ke Google Sheets'); return Promise.resolve(); } catch (error) { console.error('❌ Error saat mengirim ke Google Sheets:', error); return Promise.resolve(); // Jangan blokir transaksi } } function showSpreadsheetData() { document.getElementById('spreadsheet-modal').style.display = 'flex'; loadSpreadsheetData(); } function closeSpreadsheetData() { document.getElementById('spreadsheet-modal').style.display = 'none'; } async function loadSpreadsheetData() { // Tampilkan pemuatan document.getElementById('spreadsheet-loading').style.display = 'block'; document.getElementById('konten-spreadsheet').style.display = 'none'; try { console.log('🔄 memulai proses loading data spreadsheet...'); // Ambil data dari Google Sheets (hanya menampilkan data yang ada di spreadsheet) const spreadsheetTransactions = await fetchFromGoogleSheets(); console.log('📋 Total transaksi dari spreadsheet:', spreadsheetTransactions.length); // Filter untuk hanya menampilkan transaksi pengguna saat ini jika diperlukan const userTransactions = spreadsheetTransactions.filter(transaction => transaction.email === currentUser.email ); console.log('👤 Transaksi user saat ini:', userTransactions.length); populateTransactionsTable(userTransactions); document.getElementById('spreadsheet-loading').style.display = 'none'; document.getElementById('spreadsheet-content').style.display = 'block'; // Perbarui penyimpanan lokal untuk disinkronkan dengan spreadsheet (hapus entri yang dihapus) syncLocalStorageWithSpreadsheet(spreadsheetTransactions); // Tampilkan pesan sukses showMessage('success', `Data berhasil dimuat! Menampilkan ${userTransactions.length} transaksi terbaru dari server.`, 'dashboard'); } catch (error) { console.error('❌ Kesalahan saat memuat data spreadsheet:', error); // Fallback: Tampilkan data lokal jika tersedia console.log('🔄 Menggunakan data lokal sebagai fallback...'); const localTransactions = JSON.parse(localStorage.getItem('transactions') || '[]'); const userLocalTransactions = localTransactions.filter(transaction => transaction.email === currentUser.email ); populateTransactionsTable(userLocalTransactions); document.getElementById('spreadsheet-loading').style.display = 'none'; document.getElementById('konten-spreadsheet').style.display = 'blok'; // Tampilkan pesan peringatan jika (userLocalTransactions.length > 0) { showMessage('error', `Tidak dapat terhubung ke server. Menampilkan ${userLocalTransactions.length} data lokal. Coba refresh untuk data terbaru.`, 'dashboard'); } else { showMessage('error', 'Tidak dapat terhubung ke server dan tidak ada data lokal. Silakan coba lagi nanti.','dasbor'); } } } // Fungsi untuk menyinkronkan localStorage dengan data spreadsheet function syncLocalStorageWithSpreadsheet(spreadsheetTransactions) { try { // Dapatkan transaksi lokal terkini const localTransactions = JSON.parse(localStorage.getItem('transaksi') || '[]'); // Dapatkan ID transaksi yang ada di spreadsheet const spreadsheetIds = spreadsheetTransactions.map(t => String(t.id)); // Filter transaksi lokal untuk hanya menyimpan yang ada di spreadsheet const syncedTransactions = localTransactions.filter(localTransaction => spreadsheetIds.includes(String(localTransaction.id)) ); // Perbarui localStorage dengan data yang disinkronkan localStorage.setItem('transaksi', JSON.stringify(syncedTransactions)); console.log('✅ Penyimpanan lokal disinkronkan dengan data spreadsheet'); } catch (error) { console.error('❌ Terjadi kesalahan sinkronisasi penyimpanan lokal:', error); } } function populateTransactionsTable(transactions) { const tbody = document.getElementById('transactions-tbody'); tbody.innerHTML = ''; if (transactions.length === 0) { tbody.innerHTML = ` <tr> <td colspan="8" style="border: 1px solid #dee2e6; padding: 20px; text-align: center; color: #666;"> Belum ada data transaksi </td> </tr> `; return; } // Urutkan transaksi berdasarkan tanggal (terbaru dulu) transactions.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)); transaksi.forEach(transaksi => { const baris = dokumen.createElement('tr'); baris.style.borderBottom = '1px solid #dee2e6'; // Warna status let statusColor = '#28a745'; // hijau untuk berhasil jika (status transaksi === 'Tertunda') statusColor = '#ffc107'; // kuning untuk tertunda jika (status transaksi === 'Gagal') statusColor = '#dc3545'; // merah untuk baris yang gagal.innerHTML = ` <td style="border: 1px solid #dee2e6; padding: 8px; font-size: 12px;">${transaction.id}</td> <td style="border: 1px solid #dee2e6; padding: 8px; font-size: 12px;">${transaction.tanggal}</td> <td style="border:1 piksel solid #dee2e6; padding: 8 piksel; ukuran-font: 12 piksel;">${transaction.email}</td> <td style="border: 1 piksel solid #dee2e6; padding: 8 piksel; ukuran-font: 12 piksel;">${transaction.nama}</td> <td style="border: 1 piksel solid #dee2e6; padding: 8 piksel; ukuran-font: 12 piksel;">${transaction.noAkun}</td> <td style="border: 1 piksel solid #dee2e6; padding: 8 piksel; ukuran-font: 12 piksel; berat-font: 600; warna: #28a745;">${transaction.hadiah}</td> <td style="border: 1 piksel solid #dee2e6; padding: 8 piksel; ukuran-font: 12 piksel; warna: #dc3545;">-${transaction.pointsUsed}</td> <td style="border: 1px solid #dee2e6; padding: 8px; ukuran-font: 12px;"> <span style="background: ${statusColor}; warna: putih; padding: 4px 8px; radius-batas: 12px; font-size: 11px;"> ${transaction.status} </span> </td> `; tbody.appendChild(row); }); } function refreshSpreadsheetData() { showMessage('success', 'Memperbarui data transaksi dari server...', 'dashboard'); // Hapus semua pesan yang ada setelah penundaan singkat setTimeout(() => { clearMessages(); }, 1000); loadSpreadsheetData(); } async function exportToCSV() { try { // Dapatkan data baru dari Google Sheets (hanya transaksi yang aktif) const spreadsheetTransactions = await fetchFromGoogleSheets(); // Filter hanya untuk transaksi pengguna saat ini const userTransactions = spreadsheetTransactions.filter(transaction => transaction.email === currentUser.email ); if (userTransactions.length === 0) { alert('Tidak ada data transaksi Anda untuk diekspor!'); return; } // Buat konten CSV let csvContent = 'ID Transaksi,Tanggal,Email,Nama,No HP,Hadiah,Poin yang Digunakan,Sisa Poin,Status\n'; userTransactions.forEach(transaction => { csvContent += `${transaction.id},"${transaction.tanggal}","${transaction.email}","${transaction.nama}","${transaction.noAkun}","${transaction.hadiah}",${transaction.pointsUsed},${transaction.sisaPoin},"${transaction.status}"\n`; }); // Membuat dan mengunduh file const blob = new Blob([csvContent], { ketik:'text/csv;charset=utf-8;' }); const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', `transaksi_${currentUser.email}_${new Date().toISOString().split('T')[0]}.csv`); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); showMessage('success', `Data transaksi Anda berhasil diekspor! File CSV dengan ${userTransactions.length} transaksi telah diunduh.`, 'dashboard'); } catch (error) { console.error('Error exporting CSV:', error); showMessage('error', 'Tidak dapat mengekspor data. Silakan coba lagi nanti.', 'dashboard'); } } function logout() { currentUser = null; document.getElementById('dashboard').style.display = 'none'; document.querySelector('.auth-container').style.display = 'block'; // Restore body background document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; document.body.style.minHeight = '100vh'; document.body.style.display = 'flex'; document.body.style.alignItems = 'center'; document.body.style.justifyContent = 'center'; // Clear forms and switch to login tab document.querySelectorAll('form').forEach(form => form.reset()); switchTab('login'); clearMessages(); showMessage('success', 'Logout berhasil. Terima kasih telah menggunakan aplikasi kami!', 'login'); } // Tambahkan beberapa umpan balik interaktif document.querySelectorAll('.form-input').forEach(input => { input.addEventListener('focus', function() { this.parentElement.style.transform = 'scale(1.02)'; }); input.addEventListener('blur', function() { this.parentElement.style.transform = 'scale(1)'; }); }); </script> <script>(fungsi(){fungsi c(){var b=a.contentDocument||a.contentWindow.document;jika(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98061a7bc2bbce85',t:'MTc1ODA4NTg5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}jika(dokumen.badan){var a=dokumen.createElement('iframe');a.tinggi=1;a.lebar=1;a.gaya.posisi='mutlak';a.gaya.atas=0;a.gaya.kiri=0;a.gaya.batas='tidak ada';a.gaya.visibilitas='tersembunyi';dokumen.badan.appendChild(a);jika('memuat'!==dokumen.readyState)c();lainnya jika(jendela.addEventListener)dokumen.addEventListener('DOMContentLoaded',c);lainnya{var e=dokumen.onreadystatechange||fungsi(){};dokumen.onreadystatechange=fungsi(b){e(b);'memuat'!==dokumen.readyState&&(dokumen.onreadystatechange=e,c())}}}})();</script></body> </html>
