<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App Monetag</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .announcement {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1rem;
            color: #fff;
        }

        .stats {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .stats div {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .stats div span {
            font-weight: bold;
            color: #ffdd57;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #ad-container {
            margin-top: 20px;
            text-align: center;
        }

        /* Formulir Penarikan Poin */
        .withdrawal-form {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            z-index: 1000;
        }

        .withdrawal-form h2 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .withdrawal-form label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }

        .withdrawal-form input,
        .withdrawal-form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }

        .withdrawal-form .form-buttons {
            display: flex;
            justify-content: space-between;
        }

        .withdrawal-form .form-buttons button {
            width: 48%;
            margin: 0;
        }

        .withdrawal-form .error-message {
            color: red;
            font-size: 0.9rem;
            margin-top: -10px;
            margin-bottom: 10px;
            display: none;
        }

        /* Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* Toast Notification */
        .toast {
            visibility: hidden;
            min-width: 250px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            text-align: center;
            border-radius: 10px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .toast.show {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mini App Monetag</h1>
        
        <!-- Pengumuman -->
        <div class="announcement">
            <strong>ðŸŽ‰ Pengumuman:</strong> Selamat datang di Mini App Monetag! Lihat iklan dan kumpulkan poin Anda sekarang!
        </div>

        <!-- Statistik Iklan dan Poin -->
        <div class="stats">
            <div class="ads-today">ðŸ“Š Iklan yang dilihat hari ini: <span id="adsToday">0</span>/5</div>
            <div class="total-ads">ðŸ“ˆ Total iklan yang dilihat: <span id="totalAds">0</span></div>
            <div class="points">ðŸ’° Poin Anda: <span id="points">0</span></div>
        </div>

        <!-- Tombol untuk melihat iklan -->
        <button id="watchAdButton" onclick="startAd()">ðŸŽ¬ Lihat Iklan</button>

        <!-- Tombol Penarikan Poin -->
        <button id="withdrawButton" onclick="showWithdrawalForm()">ðŸ’³ Penarikan Poin</button>

        <!-- Container untuk menampilkan iklan Monetag -->
        <div id="ad-container">
            <!-- Iklan Monetag akan ditampilkan di sini -->
        </div>
    </div>

    <!-- Formulir Penarikan Poin -->
    <div class="overlay" id="overlay" onclick="hideWithdrawalForm()"></div>
    <div class="withdrawal-form" id="withdrawalForm">
        <h2>Formulir Penarikan Poin</h2>
        <form id="withdrawalFormContent">
            <label for="name">Nama:</label>
            <input type="text" id="name" required>

            <label for="pointsToWithdraw">Poin yang Ditukar:</label>
            <input type="number" id="pointsToWithdraw" required oninput="checkMinWithdrawal()">
            <div id="minWithdrawalMessage" class="error-message">Minimal penarikan adalah 100 poin.</div>

            <label for="paymentMethod">Metode Pembayaran:</label>
            <select id="paymentMethod" required>
                <option value="DANA">DANA</option>
                <option value="OVO">OVO</option>
                <option value="Gopay">Gopay</option>
                <option value="Bank Transfer">Bank Transfer</option>
            </select>

            <label for="phoneNumber">Nomor HP Pembayaran:</label>
            <input type="text" id="phoneNumber" required>

            <label for="date">Tanggal:</label>
            <input type="text" id="date" value="" readonly>

            <div class="form-buttons">
                <button type="button" onclick="submitWithdrawal()">Kirim</button>
                <button type="button" onclick="hideWithdrawalForm()">Batal</button>
            </div>
        </form>
    </div>

    <!-- Pesan mengambang (toast) -->
    <div id="toast" class="toast"></div>

    <!-- Skrip Monetag -->
    <script src='//whephiwums.com/sdk.js' data-zone='8654720' data-sdk='show_8654720'></script>

    <script>
        // Data simulasi
        let adsToday = 0;
        const dailyAdLimit = 5; // Batasan iklan per hari
        let totalAds = 0;
        let points = 0;
        let isAdButtonDisabled = false;
        const minWithdrawal = 100; // Minimal penarikan poin

        // Token dan Chat ID Admin Telegram
        const botToken = 'YOUR_BOT_TOKEN'; // Ganti dengan token bot Telegram Anda
        const adminChatId = 'ADMIN_CHAT_ID'; // Ganti dengan chat ID admin Telegram

        // Fungsi untuk menampilkan pesan mengambang
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.add('show'); // Tampilkan toast
            setTimeout(() => {
                toast.classList.remove('show'); // Sembunyikan toast setelah durasi
            }, duration);
        }

        // Fungsi untuk menyimpan data ke local storage
        function saveData() {
            localStorage.setItem('adsToday', adsToday);
            localStorage.setItem('totalAds', totalAds);
            localStorage.setItem('points', points);
            localStorage.setItem('lastResetDate', new Date().toLocaleDateString()); // Simpan tanggal terakhir reset
        }

        // Fungsi untuk memuat data dari local storage
        function loadData() {
            const lastResetDate = localStorage.getItem('lastResetDate');
            const currentDate = new Date().toLocaleDateString();

            // Reset data harian jika tanggal terakhir reset berbeda dengan tanggal sekarang
            if (lastResetDate !== currentDate) {
                localStorage.setItem('adsToday', 0); // Reset iklan yang dilihat hari ini
                localStorage.setItem('lastResetDate', currentDate); // Update tanggal terakhir reset
            }

            adsToday = parseInt(localStorage.getItem('adsToday')) || 0;
            totalAds = parseInt(localStorage.getItem('totalAds')) || 0;
            points = parseInt(localStorage.getItem('points')) || 0;

            // Update tampilan
            document.getElementById('adsToday').innerText = `${adsToday}/${dailyAdLimit}`;
            document.getElementById('totalAds').innerText = totalAds;
            document.getElementById('points').innerText = points;
        }

        // Fungsi untuk menampilkan formulir penarikan poin
        function showWithdrawalForm() {
            document.getElementById('withdrawalForm').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('date').value = new Date().toLocaleDateString(); // Set tanggal hari ini
        }

        // Fungsi untuk menyembunyikan formulir penarikan poin dan mereset formulir
        function hideWithdrawalForm() {
            document.getElementById('withdrawalForm').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            resetWithdrawalForm(); // Reset formulir saat ditutup
        }

        // Fungsi untuk mereset formulir penarikan poin
        function resetWithdrawalForm() {
            document.getElementById('withdrawalFormContent').reset();
            document.getElementById('date').value = new Date().toLocaleDateString(); // Set ulang tanggal
            document.getElementById('minWithdrawalMessage').style.display = 'none'; // Sembunyikan pesan minimal penarikan
        }

        // Fungsi untuk memeriksa batasan minimal penarikan
        function checkMinWithdrawal() {
            const pointsToWithdraw = document.getElementById('pointsToWithdraw').value;
            const minWithdrawalMessage = document.getElementById('minWithdrawalMessage');

            if (parseInt(pointsToWithdraw) < minWithdrawal) {
                minWithdrawalMessage.style.display = 'block'; // Tampilkan pesan minimal penarikan
            } else {
                minWithdrawalMessage.style.display = 'none'; // Sembunyikan pesan minimal penarikan
            }
        }

        // Fungsi untuk mengirim formulir penarikan poin
        async function submitWithdrawal() {
            const name = document.getElementById('name').value;
            const pointsToWithdraw = document.getElementById('pointsToWithdraw').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const date = document.getElementById('date').value;

            if (!name || !pointsToWithdraw || !paymentMethod || !phoneNumber) {
                showToast("Harap isi semua field!", 3000);
                return;
            }

            if (parseInt(pointsToWithdraw) < minWithdrawal) {
                showToast(`Minimal penarikan adalah ${minWithdrawal} poin.`, 3000);
                return;
            }

            if (parseInt(pointsToWithdraw) > points) {
                showToast("Poin yang diminta melebihi poin yang Anda miliki!", 3000);
                return;
            }

            // Kirim pesan ke admin Telegram
            const message = `ðŸ“ *Permintaan Penarikan Poin*:\n\n` +
                `Nama: ${name}\n` +
                `Poin yang Ditukar: ${pointsToWithdraw}\n` +
                `Metode Pembayaran: ${paymentMethod}\n` +
                `Nomor HP Pembayaran: ${phoneNumber}\n` +
                `Tanggal: ${date}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: adminChatId,
                        text: message,
                        parse_mode: 'Markdown',
                    }),
                });

                const data = await response.json();

                if (data.ok) {
                    // Potong poin jika pengiriman berhasil
                    points -= parseInt(pointsToWithdraw);
                    document.getElementById('points').innerText = points;
                    saveData(); // Simpan perubahan poin ke local storage
                    showToast("Permintaan penarikan poin berhasil dikirim ke admin.", 3000);
                } else {
                    showToast("Gagal mengirim permintaan penarikan poin. Silakan coba lagi.", 3000);
                }
            } catch (error) {
                console.error('Error:', error);
                showToast("Terjadi kesalahan. Silakan coba lagi.", 3000);
            }

            // Reset formulir dan sembunyikan
            resetWithdrawalForm();
            hideWithdrawalForm();
        }

        // Fungsi untuk memulai iklan
        function startAd() {
            if (adsToday >= dailyAdLimit) {
                showToast("Anda telah mencapai batas iklan hari ini.", 3000);
                return;
            }

            // Nonaktifkan tombol sementara
            disableAdButton();
            // Tampilkan iklan Monetag
            showMonetagAd();
        }

        // Fungsi untuk menampilkan iklan Monetag
        function showMonetagAd() {
            // Pastikan skrip Monetag sudah dimuat
            if (typeof window.show_8654720 === 'function') {
                // Simulasi callback ketika iklan selesai dilihat
                window.show_8654720();
                setTimeout(() => {
                    // Asumsikan iklan selesai dilihat setelah 5 detik
                    onAdComplete();
                }, 5000); // Ganti dengan callback asli dari SDK Monetag jika ada
            } else {
                console.error('Monetag SDK belum dimuat.');
                showToast("Iklan tidak dapat dimuat. Silakan coba lagi.", 3000);
                enableAdButton(); // Aktifkan kembali tombol jika iklan gagal
            }
        }

        // Fungsi yang dipanggil ketika iklan selesai dilihat
        function onAdComplete() {
            adsToday++;
            totalAds++;
            points += 10; // Setiap iklan memberikan 10 poin

            // Update tampilan
            document.getElementById('adsToday').innerText = `${adsToday}/${dailyAdLimit}`;
            document.getElementById('totalAds').innerText = totalAds;
            document.getElementById('points').innerText = points;

            // Simpan perubahan ke local storage
            saveData();

            // Tampilkan pesan mengambang
            showToast("ðŸŽ‰ Terima kasih! Anda mendapatkan 10 poin.", 3000);

            // Jika batasan iklan per hari terpenuhi, nonaktifkan tombol
            if (adsToday >= dailyAdLimit) {
                document.getElementById('watchAdButton').disabled = true;
                document.getElementById('watchAdButton').innerText = "Batas Iklan Hari Ini Terpenuhi";
            } else {
                // Aktifkan tombol setelah hitungan mundur
                startCountdown(10); // Hitungan mundur 10 detik
            }
        }

        // Fungsi untuk menonaktifkan tombol sementara
        function disableAdButton() {
            const button = document.getElementById('watchAdButton');
            button.disabled = true;
            button.innerText = "Memuat Iklan...";
            isAdButtonDisabled = true;
        }

        // Fungsi untuk mengaktifkan tombol setelah hitungan mundur
        function enableAdButton() {
            const button = document.getElementById('watchAdButton');
            button.disabled = false;
            button.innerText = "ðŸŽ¬ Lihat Iklan";
            isAdButtonDisabled = false;
        }

        // Fungsi untuk hitungan mundur
        function startCountdown(seconds) {
            const button = document.getElementById('watchAdButton');
            let countdown = seconds;

            const interval = setInterval(() => {
                button.innerText = `Tunggu ${countdown} detik...`;
                countdown--;

                if (countdown < 0) {
                    clearInterval(interval);
                    enableAdButton();
                }
            }, 1000);
        }

        // Inisialisasi data awal
        loadData();
    </script>
</body>
</html>
